## OS_ミドルウェア調査

<hr>

### OS
Apacheを使いたい場合は「UNIX系」  
ActiveDirectoryを使いたい場合は「Windows系」

### ■UNIX系サーバ（LINUX）
* OSSかつUNIX互換のOS
* セキュリティ的に強く脆弱性が少ない
* Apacheとの互換性も高いため人気

### ■Windows系サーバ
* GUI操作が可能で初心者でも操作しやすい
* セキュリティ的に弱い
* ライセンス購入が必要
* ActiveDirectoryが利用可能

<hr>

### WEB, PROXYサーバ
負荷が高くなく、早期セットアップが必要な場合は「Apache」  
負荷が高く、スケーラビリティが要求される場合は「nginx」

### ■Apache（プロセス駆動）
* おそらく最も安定した人気のWEBサーバ
* UNIX, LINUX環境でよく使われる（もともとLinux上で動くことを想定されて作成されたようだ）
* リバースプロキシの設定も可能。リクエストをL7で振り分けられる（mod_proxy）
* マルチプロセス。リクエストが大量に来た際、プロセスが同時に起動するのでオーバーヘッドが非常に大きくなるというデメリット
* マルチプロセスであるため、CPUリソースがたくさん必要な処理に向いている
* プロセスチューニングによりNginx同等か以下まで性能を上げることができる
* mod_*で動的コンテンツの高速化ができる

### ■NginX（イベント駆動）
* シングルスレッドモデル。 シングルスレッドでループ処理をまわし、キューに溜まったイベントを処理していく処理方式。プロセス数はCPUコア数と基本的には同じに設定
* クライアントの数が多くなるとサーバがパンクする場合がある。プロセス番号が足りなくなる
* 処理が軽く、大量のリクエストを処理するのに向いている（Apacheよりもnginxの方が1.47倍処理能力が高い）
* 静的コンテンツが早い

### ■IIS
* Windows環境でよく使われる。
* ASP(.NET Framework)を使って簡単に動的なWebページを作成できる
* マルチスレッド、マルチプロセスが可能
* 基本的な管理もGUIで操作できる

### ■Squid（proxyサーバ）
* HTTP、HTTPS、FTPなどに対応したキャッシュプロキシ
* プロキシサーバ、リバースプロキシサーバ、キャッシュサーバ
* 何らかの理由でダウンしてリスタートするときにキャッシュインデックスをログファイルから読み直して再構築する

<hr>

### APサーバ
商用+EJBなら「WebLogic」  
OSS+EJBなら「GlassFish」, 多機能高性能なら「JBoss」  
OSS+サーブレットコンテナなら「Tomcat」  

### ■WebLogic
* ORACLE社商用のEJBの実装版アプリケーションサーバ（高価）
* BEA独自のJava高速化実行環境「BEA WebLogic JRocket」
* 診断機能でCPUやメモリ利用状況を解析可能

### ■GlassFish
* ORACLE社のEJBの実装版OSSアプリケーションサーバ
* Web コンテナだけではなくトランザクション管理やリソース管理が充実し、EJB コンテナも含む
* GUI/CLI で管理ができる

### ■Tomcat
* サーブレットコンテナのデファクトスタンダード
* JSPとServletを実行させるためのアプリケーションサーバ（Webサーバと連携して実行する環境を構築できる）

### ■WildFly
* EJBの実装版OSSアプリケーションサーバ（商用JBoss）
* マルチコアプロセッサを活用した並行処理などにより高速に動作する
* Webコンテナ「Tomcat」と、軽量データベース「HSQLDB」を標準搭載
* tomcatと比較して非常に多機能（EJB,MDB,JPA,JMS,JCA,JAX-WS,JMX,log4jなど）

<hr>

### RDBMS
商用+多機能高性能なら「ORACLE」  
OSS+多機能高性能なら「PostgreSQL」  
OSS+単純高速なら「MySQL 」  
アプリケーション組み込み型なら「SQLit」「H2」

### ■Oralce
* 更新型アーキテクチャ
* 高機能、高価格
* 管理ツールとしてOEMがあるが使いこなすのが困難
* バージョン毎に便利な新機能が追加になるがバグ処理の覚悟が必要
* チューニングスキルなどに専門技術者が必要
* 変更の操作にロールバックセグメント（UNDO領域）を使用し、commitでセグメントを上書きする（MySQL同様）
* EXADETAはカラム形データベースで圧縮効率やデータ集計系、特定の列を処理するようなクエリが得意

### ■PostgreSQL
* レコード追記型アーキテクチャ
* 変更の操作はレコード追記しポインタを変更することで制御する
* CPU数が増えた場合のスケーラビリティが高く、接続数が増えても性能が維持される
* 不要レコードの回収のためにメンテナンス処理（VACUUM）が必要になる
* オープンソースライセンス「The PostgreSQL Licence」で公開。商用利用も可
* JOINのアルゴリズムが複数ある
* 利用するINDEXは1TBLで複数可能
* 複雑なSQLは得意。

### ■MySQL
* 更新型アーキテクチャ
* マルチユーザー対応で、データ量が多いWebやデータウェアハウス（DWH）のシステム構築に適している
* 商用ライセンスにはサポートあり
* 非常に高速・使いやすいと有名
* JOINのアルゴリズムがひとつしかない
* 利用するINDEXは1TBLに1つ
* JOINする場合はINDEX利用してできる限り少量にする

### Amazon RDS
* AmazonのマネージドなRDBMSサービス
* MultiAZで冗長化が可能（同期レプリケーション）
* 障害時にはMultiAZで作成された待機系へフェールオーバされる
* Amazonがマイナーバージョンアップをしてくれる
* 管理コンソールからスケール変更が簡単にできる
* リードレプリカを配置可能

### Amazon Aurora(RDS)
* MySQLより1.2倍ほど高いが、MultiAZ設定のRDSと同一構成では約70%の費用
* 標準のMySQLと比較して5倍のスループット
* Auroraレプリカを作成することでMultiAZとなる。障害時にはAuroraレプリカの優先順位に基づきAuroraレプリカにフェールオーバを行う
* MultiAZでは3つのアベイラリティゾーンに2つずつのレプリケーションを保存する
* ストレージ容量は10GBから最大64TBまで動的に容量を変更
* マスタ・スレーブが同じディスク(共有ストレージのようなもの)を見ている。そのため、レプリカ遅延が少なく、データ同期のオーバーヘッドも少ない

### ■SQLite
* アプリケーションの一部に組み込まれて動作する
* ユーザやアクセス権限の概念がない

### ■H2
* アプリケーションの一部に組み込まれて動作する
* インメモリデータベース

<hr>

### その他
### NoSQL
ACID特性の一部を保証しない、シンプルなクエリのみという制限をすることで、柔軟なスケールアウトや可用性の向上、高スループットが可能  
参照のみなどトランザクション処理が不要なデータに関してはNoSQLの選択支があるといえる  

### ■DynamoDB（NoSQL）
* リクエスト数を定義しあらかじめキャパシティを確保しておく。
* データ容量、指定したスループットに応じたディスクやノードの増設はAmazon側で自動  
* スキーマレス  
Table = テーブル  
items = 行  
attributes = カラム  
* キー（一意制約、暗黙的なインデックス）
* 明示的に定義するインデックス  
LSI（ローカル・セカンダリ・インデックス）とGSI（グローバル・セカンダリ・インデックス）

### ■ElastiCache（インメモリデータストア）
* Redis, MemCached　のOSSキャッシュエンジンをサポート
* データアクセスの高速化、セッションの保持などの用途で使用される
* MemCachedではクライアントライブラリが格納したいデータのキー毎に、格納したいノードを決定する。データのレプリケーションは行わずキー毎にノードを分けてキャッシュ保存する。
* Redisではマスタ、スレーブのレプリケーションによってデータ同期を行うため、更新後は多少のレプリケーション遅延が発生する

<hr>

### CDN
### ■Akamai
* 世界最大シェアのCDN（世界のトラフィックの1/3）
* 分散型CDN。エッジサーバの多さNo1。世界各所に分散して配置されている
* 高価だが、最速（おそらく）
* CDN以外のソリューションが豊富（画像リサイズ、ネットワーク最適化、ABテストツールなど）
* 100%の可用性

### ■CloudFront
* 安価な従量課金、初期費用なし
* 集中型CDN。キャッシュヒット率が高い
* AWSの他システムと親和性が高い（route53、S3）
* おそらく99.9%（これ以下なら返金対象）
